System Instructions

【博物館ガイドシステム】基本設計・実装ルール
1. システム全体構成
    管理階層:
        スーパーバイザー(SV): 全館管理・設定。配色：ネイビー。
        博物館管理者(Admin): 自館の展示・スタッフ管理。配色：グリーン。
        一般利用者(App): 来館者向け案内。シンプル・実用重視。
    技術スタック: PHP (PDO使用), MySQL (Xserver), JavaScript (jsQR, Web Speech API)。
    セッション分離: common/db_inc.php にてフォルダ別にセッション名（MUSEUM_SV_SESS等）を自動変更。同一ブラウザでの複数ロール同時ログインを可能にする。

2. 利用者アプリ (app/) のUXデザイン原則
    徹底的な実用主義: 開発者の自己満足（無駄なヒーロー画像等）を排除し、現地ユーザーが知りたい情報（展示解説）に最短でたどり着ける構成にする。
    QRボタンの統一: 全画面共通で「中央下固定」。形状はカプセル型（ピル型）、色はグリーン。アイコンはドットが入ったスキャナーフレーム型を使用。
    ナビゲーション: QRから直接アクセスするユーザーを考慮し、ヘッダーに「戻る」「ホーム」等の不要なボタンを置かない。
    博物館詳細 (view.php): 施設情報はℹ️ボタンによるモーダル（ポップアップ）に隠し、メイン画面は「検索バー（Sticky）」と「展示リスト」のみにする。展示数増加（100件超）対策として「もっと見る」ボタンで20件ずつ読み込む。
    多言語化：ブラウザの言語仕様に自動で合わせる。ユーザーの切り替えもできるように邪魔にならない位置に切り替え機能を用意する

3. 管理画面 (sv/ / admin/) の実装ルール
    配色による識別: SVはネイビー（#34495e）、管理者はグリーン（#26b396）で配色を統一し、誤操作を防ぐ。
    多言語翻訳ツール: 「他言語を一括生成（魔法の杖アイコン🪄）」ボタンを配置。位置は入力欄の右上（右寄せ）。
    翻訳中UI: 翻訳実行時は画面全体をブロックするオーバーレイダイアログを表示し、他操作を禁止する。中断（キャンセル）機能も必須。
    メール送信: Xserver環境での文字化け防止のため、mb_language("uni")・UTF-8・-fオプション指定を厳守する。

4. 広告・収益モデル (ad_type)
    4つの出し分けモード:
    0: AdSense（標準・SV収益）
    1: SV指定広告（スポンサー・SV収益）
    2: 自館PR広告（博物館独自・利用料収益）
    9: 非表示（公立博物館等・高額利用料収益）

5. 開発コミュニケーションルール
    議論優先: 複雑な機能の作成前に、必ずユーザー体験や意図について話し合う。
    勝手なコード生成禁止: 議論が完全に合致し、ユーザーからの具体的な「コード作成指示」があるまで、プログラムを書かない。
    全コード提示: 修正ミスを防ぐため、常にファイル全体のソースコードを提示する。